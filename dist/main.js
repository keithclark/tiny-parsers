const e=(e,t)=>{const r=[];for(let s=128;s<1024;s++){const n=String.fromCharCode(s);if(!e.includes(n)&&(r.push(n),r.length>=t))break}return r},t=()=>{throw new TypeError("Invalid input")},r=(e,t={})=>e.replace(/&([a-z]+|#\d+|#x[\da-z]+);/gi,((e,r)=>{if("#"==r.at(0))return"x"==r.at(1).toLowerCase()?String.fromCharCode(parseInt(r.slice(2),16)):String.fromCharCode(+r.slice(1));if(Object.hasOwn(t,r))return t[r];throw new TypeError(`Unknown entity: ${r}`)})),s=e=>e.replace(/[\u00A0-\u9999<>&"'`]/gim,(e=>"&#"+e.charCodeAt(0)+";")),n=1,a=2,i=3,l=/<([a-z][\w-]*)(\s[^>]*)?>([^<]*)<\/\1\s*>/g,p=/\s+([\w:-]+)(?:=(?:"([^"]*)"|'([^']*)'|([^\s"'>]+)))?(?=\s|$)/g;var c=(s,n={})=>{const a=[],{namedEntityMap:i,textElements:c,voidElements:o}=n,[u,$]=e(s,2),d=new RegExp(`${u}(\\d+)${$}`,"g"),g=e=>{const t=[];return e.split(d).forEach(((e,s)=>{s%2?t.push(a.at(+e)):""!==e&&t.push(((e="")=>({type:2,value:e}))(r(e,i)))})),t},h=e=>`${u}${a.push(e)-1}${$}`,m=(e,t)=>h(((e="")=>({type:3,value:e}))(t)),y=(e,t,r,s,n)=>n?m(0,n):f(e,t,r,s),f=(e,t,s,n)=>{const a=((e,t={},r=[])=>({type:1,name:e,attributes:t,children:r}))(t,{},g(n));return s?.replace(p,((e,t,s)=>{a.attributes[t]=r(s??t,i)})),h(a)},E=(e,t,r)=>f(e,t,r,"");if(c){const e=new RegExp(`(?:<(${c.join("|")})(\\s[^>]*)?>(.*?)<\\/\\1s*>)|(?:\x3c!--(.*?)--\x3e)`,"gs");s=s.replace(e,y)}else s=s.replace(/<!--(.*?)-->/gs,m);if(o){const e=new RegExp(`<(${o.join("|")})(\\s[^>]*)?>`,"g");s=s.replace(e,E)}for(;l.test(s);)s=s.replace(l,f);return s.includes("<")&&t(),g(s)};const o=(e,t={})=>{const{voidElements:r=[]}=t;return(e=>{const{type:t,value:n}=e;if(3===t)return`\x3c!--${n}--\x3e`;if(2===t)return s(n);if(1===t){const t=e,n=[];return n.push(`<${e.name}`),t.attributes&&Object.entries(t.attributes).forEach((([e,t])=>{n.push(` ${e}="${s(t)}"`)})),n.push(">"),r.includes(e.name)||(n.push(...e.children?.map(o)),n.push(`</${e.name}>`)),n.join("")}})(e)};var u=(e,t={})=>e.map((e=>o(e,t))).join("");const $=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"],d=["script","style","textarea","title"],g={amp:"&",gt:">",lt:"<",quot:'"'};var h=(e,t)=>c(e,{namedEntityMap:g,voidElements:$,textElements:d,...t}),m=(e,t={})=>u(e,{namedEntityMap:g,voidElements:$,textElements:d,...t});const y=1,f=2,E=3,w=4,x=e=>e.includes('"')||e.includes("'"),v=e=>e=(e=(e=>e.replace(/\s+/g," "))(e)).replace(/, /g,","),b=/(\/\*(?:[\w\W]*?)\*\/)|(?:(["'])(?:\\.|(?!\2)[^\\\r\n])*\2)|([a-z]\(\s*[^'"].*?\))/g,C=/([\w-]+)\s*:\s*((?:[^\s:;][^:;]*?)|\s)\s*(;|$|\})/g,j=/@(-?[a-z][^{;@\s]*\s[^{;@]+?);/gi;var R=r=>{const[s,n,a,i]=e(r,4),l=new RegExp(`${s}(\\d+)${n}`,"g"),p=new RegExp(`${a}(\\d+)${i}`,"g"),c=new RegExp(`(?<=^|[;{}${s}${n}])\\s*([^;{}${s}${n}]+?)\\s*\\{([^{]*?)\\}`,"g"),o=[],u=[],$=(e,t,r,s)=>`${r}${e.push(t)-1}${s}`,d=e=>$(o,e,s,n),g=e=>$(u,e,a,i),h=e=>e.replace(p,((e,t)=>u[t])),m=(e,t=null)=>{const r=e.search(/\s+/,2),s=r>-1?e.slice(0,r):e,n=r>-1?h(e.slice(r).trim()):"";return t?((e,t,r)=>({type:3,identifier:e,rule:t,declarations:r}))(s,n,t):((e,t)=>({type:4,identifier:e,rule:t}))(s,n)},y=(e,r)=>{const s=[];e=v(e);return(r=v(r)).split(l).forEach(((e,r)=>{r%2?s.push(o.at(+e)):e&&""!==e.replace(C,((e,r,n)=>(r.startsWith("--")||" "!==n||t(),s.push(((e,t)=>({type:1,property:e,value:t}))(r,h(n))),""))).trim()&&t()})),e.startsWith("@")?m(e.slice(1),s):{type:2,selector:h(e),declarations:s}};for(r=r.replace(b,(e=>"("===e.at(1)||x(e.at(0))?g(e):"")),x(r)&&t(),r=r.replace(j,((e,t)=>d(m(t))));c.test(r);)r=r.replace(c,((e,t,r)=>d(y(t,r))));return y("",r).declarations};const z=e=>{let t="";return e.forEach(((r,s)=>{t+=S(r),(1===r.type&&s!==e.length-1||4===r.type)&&(t+=";")})),t},S=e=>2===e.type?`${e.selector}{${z(e.declarations)}}`:4===e.type?`@${e.identifier} ${e.rule}`:3===e.type?`${(e=>{let{rule:t,identifier:r}=e,s=`@${r}`;return t&&(s+=` ${t}`),s})(e)}{${z(e.declarations)}}`:1===e.type?`${e.property}:${e.value}`:void 0;var k=(e,t={})=>z(e);export{i as NODE_TYPE_COMMENT,n as NODE_TYPE_ELEMENT,a as NODE_TYPE_TEXT,E as RULE_TYPE_AT_RULE_BLOCK,w as RULE_TYPE_AT_RULE_STATEMENT,y as RULE_TYPE_DECLARATION,f as RULE_TYPE_RULESET,R as parseCss,h as parseHtml,c as parseSgml,k as stringifyCss,m as stringifyHtml,u as stringifySgml};
