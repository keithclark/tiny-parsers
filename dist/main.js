const e=(e,t)=>{const r=[];for(let n=128;n<1024;n++){const s=String.fromCharCode(n);if(!e.includes(s)&&(r.push(s),r.length>=t))break}return r},t=()=>{throw new TypeError("Invalid input")},r=(e,t=" ")=>e.replace(/\s+/g," "),n=e=>"("===e.at(0)&&")"===e.at(-1),s=e=>{const t=e.at(0),r=e.at(-1);return('"'===t||"'"===t)&&t==r},a=(e,t={})=>e.replace(/&([a-z]+|#\d+|#x[\da-z]+);/gi,((e,r)=>{if("#"==r.at(0))return"x"==r.at(1).toLowerCase()?String.fromCharCode(parseInt(r.slice(2),16)):String.fromCharCode(+r.slice(1));if(Object.hasOwn(t,r))return t[r];throw new TypeError(`Unknown entity: ${r}`)})),i=e=>e.replace(/[\u00A0-\u9999<>&"'`]/gim,(e=>"&#"+e.charCodeAt(0)+";")),l=1,p=2,c=3,o=4,u=(e="")=>({type:2,value:e}),g=/<!doctype\s+([^\s>]+)\s*(.*?)>/gi,m=/<([a-z][\w-]*)(\s[^>]*)?>([^<]*)<\/\1\s*>/g,$=/\s+([\w:-]+)(?:=(?:"([^"]*)"|'([^']*)'|([^\s"'>]+)))?(?=\s|$)/g;var d=(r,n={})=>{const s=[],{namedEntityMap:i,textElements:l=[],voidElements:p=[]}=n,[c,o]=e(r,2),d=new RegExp(`${c}(\\d+)${o}`,"g"),h=e=>{const t=[];return e.split(d).forEach(((e,r)=>{r%2?t.push(s.at(+e)):""!==e&&t.push(u(a(e,i)))})),t},y=e=>`${c}${s.push(e)-1}${o}`,f=(e,t)=>y(((e="")=>({type:3,value:e}))(t)),E=(e,t,r,n,s)=>s?f(0,s):x(e,t,r,n),x=(e,t,r,n)=>{let s;s=l.includes(t)?[u(n)]:h(n);const p=((e,t={},r=[])=>({type:1,name:e,attributes:t,children:r}))(t,{},s);return r?.replace($,((e,t,r)=>{p.attributes[t]=a(r??t,i)})),y(p)},w=(e,t,r)=>x(e,t,r,"");if(l.length){const e=new RegExp(`(?:<(${l.join("|")})(\\s[^>]*)?>(.*?)<\\/\\1s*>)|(?:\x3c!--(.*?)--\x3e)`,"gs");r=r.replace(e,E)}else r=r.replace(/<!--(.*?)-->/gs,f);if(r=r.replace(g,((e,t,r)=>y(((e="",t="")=>({type:4,name:e,legacyString:t}))(t,r)))),p.length){const e=new RegExp(`<(${p.join("|")})(\\s[^>]*)?>`,"g");r=r.replace(e,w)}for(;m.test(r);)r=r.replace(m,x);return r.includes("<")&&t(),h(r)};var h=(e,t={})=>e.map((e=>((e,t={})=>{const{voidElements:r=[],textElements:n=[]}=t,s=e=>{const{type:t,value:a}=e;if(3===t)return`\x3c!--${a}--\x3e`;if(4===t){const{name:t,legacyString:r}=e;let n=t;return r&&(n+=` ${r}`),`<!doctype ${n}>`}if(2===t)return i(a);if(1===t){const t=e,a=[];if(a.push(`<${e.name}`),t.attributes&&Object.entries(t.attributes).forEach((([e,t])=>{a.push(` ${e}="${i(t)}"`)})),a.push(">"),!r.includes(e.name)){let t;t=n.includes(e.name)?e=>e.value:s,a.push(...e.children?.map(t)),a.push(`</${e.name}>`)}return a.join("")}};return s(e)})(e,t))).join("");const y=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"],f=["script","style","textarea","title"],E={amp:"&",gt:">",lt:"<",quot:'"'};var x=(e,t)=>d(e,{namedEntityMap:E,voidElements:y,textElements:f,...t}),w=(e,t={})=>h(e,{voidElements:y,textElements:f,...t});const v=1,b=2,C=3,S=4,j=/(\/\*(?:[\w\W]*?)\*\/)|(?:(["'])(?:\\.|(?!\2)[^\\\r\n])*\2)|(\((?:\\.|[^()"'])*?\))/g,R=/([\w-]+)\s*:([^:]*?)(;|$|\})/g,k=/@(-?[a-z][^{;@\s]*\s[^{;@]+?);/gi;var z=a=>{const[i,l,p,c]=e(a,4),o=new RegExp(`${i}(\\d+)${l}`,"g"),u=new RegExp(`${p}(\\d+)${c}`,"g"),g=new RegExp(`(?<=^|[;{}${i}${l}])\\s*([^;{}${i}${l}]+?)\\s*\\{([^{]*?)\\}`,"g"),m=[],$=[],d=(e,t,r,n)=>`${r}${e.push(t)-1}${n}`,h=e=>d(m,e,i,l),y=e=>d($,e,p,c),f=e=>e.replace(u,((e,t)=>$[t])),E=(e,t=null)=>{const n=(e=(e=r(e)).replace(/ ?, ?/g,",")).indexOf(" ");let s=e,a="";return n>-1&&(s=e.slice(0,n),a=f(e.slice(n).trim()),"media"!==s&&"container"!==s||(a=a.replace(/ ?([<>=:\/]) ?/g,"$1"))),t?((e,t,r)=>({type:3,identifier:e,rule:t,declarations:r}))(s,a,t):((e,t)=>({type:4,identifier:e,rule:t}))(s,a)},x=e=>(e=(e=r(e)).replace(/ ?([,() ]) ?/g,"$1"),f(e)),w=(e,n)=>{const s=[];return n.split(o).forEach(((e,n)=>{n%2?s.push(m.at(+e)):e&&""!==e.replace(R,((e,n,a)=>(s.push(((e,n)=>{n=(n=r(n)).replace(/ ?, ?/g,","),e.startsWith("--")?" "!==n&&(n=n.trim()):""===(n=n.trim())&&t();const s=n.endsWith("!important");return s&&(n=n.slice(0,-10).trimEnd()),((e,t,r)=>({type:1,property:e,value:t,important:r}))(e,f(n),s)})(n,a)),""))).trim()&&t()})),e?e.startsWith("@")?E(e.slice(1),s):{type:2,selectors:r(e).split(/ ?, ?/).map((e=>(""===e&&t(),e=e.replace(/ ?([+>~]) ?/g,"$1"),f(e)))),declarations:s}:s};for(;j.test(a);)a=a.replace(j,(e=>n(e)?y(x(e)):s(e)?y(e):""));for((e=>e.includes('"')||e.includes("'"))(a)&&t(),a=a.replace(k,((e,t)=>h(E(t))));g.test(a);)a=a.replace(g,((e,t,r)=>h(w(t,r))));return w("",a)};const O=e=>{let t="";return e.forEach(((r,n)=>{t+=W(r),(1===r.type&&n!==e.length-1||4===r.type)&&(t+=";")})),t},W=e=>2===e.type?`${e.selectors}{${O(e.declarations)}}`:4===e.type?`@${e.identifier} ${e.rule}`:3===e.type?`${(e=>{let{rule:t,identifier:r}=e,n=`@${r}`;return t&&(n+=` ${t}`),n})(e)}{${O(e.declarations)}}`:1===e.type?`${e.property}:${e.value}${e.important?"!important":""}`:void 0;var A=(e,t={})=>O(e);export{c as NODE_TYPE_COMMENT,o as NODE_TYPE_DOCTYPE,l as NODE_TYPE_ELEMENT,p as NODE_TYPE_TEXT,C as RULE_TYPE_AT_RULE_BLOCK,S as RULE_TYPE_AT_RULE_STATEMENT,v as RULE_TYPE_DECLARATION,b as RULE_TYPE_RULESET,z as parseCss,x as parseHtml,d as parseSgml,A as stringifyCss,w as stringifyHtml,h as stringifySgml};
