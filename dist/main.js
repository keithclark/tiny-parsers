const e=(e,t)=>{const r=[];for(let s=128;s<1024;s++){const n=String.fromCharCode(s);if(!e.includes(n)&&(r.push(n),r.length>=t))break}return r},t=()=>{throw new TypeError("Invalid input")},r=(e,t=" ")=>e.replace(/\s+/g," "),s=(e,t={})=>e.replace(/&([a-z]+|#\d+|#x[\da-z]+);/gi,((e,r)=>{if("#"==r.at(0))return"x"==r.at(1).toLowerCase()?String.fromCharCode(parseInt(r.slice(2),16)):String.fromCharCode(+r.slice(1));if(Object.hasOwn(t,r))return t[r];throw new TypeError(`Unknown entity: ${r}`)})),n=e=>e.replace(/[\u00A0-\u9999<>&"'`]/gim,(e=>"&#"+e.charCodeAt(0)+";")),a=1,i=2,l=3,p=4,c=(e="")=>({type:2,value:e}),o=/<!doctype\s+([^\s>]+)\s*(.*?)>/gi,u=/<([a-z][\w-]*)(\s[^>]*)?>([^<]*)<\/\1\s*>/g,d=/\s+([\w:-]+)(?:=(?:"([^"]*)"|'([^']*)'|([^\s"'>]+)))?(?=\s|$)/g;var g=(r,n={})=>{const a=[],{namedEntityMap:i,textElements:l=[],voidElements:p=[]}=n,[g,m]=e(r,2),$=new RegExp(`${g}(\\d+)${m}`,"g"),h=e=>{const t=[];return e.split($).forEach(((e,r)=>{r%2?t.push(a.at(+e)):""!==e&&t.push(c(s(e,i)))})),t},y=e=>`${g}${a.push(e)-1}${m}`,f=(e,t)=>y(((e="")=>({type:3,value:e}))(t)),E=(e,t,r,s,n)=>n?f(0,n):x(e,t,r,s),x=(e,t,r,n)=>{let a;a=l.includes(t)?[c(n)]:h(n);const p=((e,t={},r=[])=>({type:1,name:e,attributes:t,children:r}))(t,{},a);return r?.replace(d,((e,t,r)=>{p.attributes[t]=s(r??t,i)})),y(p)},w=(e,t,r)=>x(e,t,r,"");if(l.length){const e=new RegExp(`(?:<(${l.join("|")})(\\s[^>]*)?>(.*?)<\\/\\1s*>)|(?:\x3c!--(.*?)--\x3e)`,"gs");r=r.replace(e,E)}else r=r.replace(/<!--(.*?)-->/gs,f);if(r=r.replace(o,((e,t,r)=>y(((e="",t="")=>({type:4,name:e,legacyString:t}))(t,r)))),p.length){const e=new RegExp(`<(${p.join("|")})(\\s[^>]*)?>`,"g");r=r.replace(e,w)}for(;u.test(r);)r=r.replace(u,x);return r.includes("<")&&t(),h(r)};var m=(e,t={})=>e.map((e=>((e,t={})=>{const{voidElements:r=[],textElements:s=[]}=t,a=e=>{const{type:t,value:i}=e;if(3===t)return`\x3c!--${i}--\x3e`;if(4===t){const{name:t,legacyString:r}=e;let s=t;return r&&(s+=` ${r}`),`<!doctype ${s}>`}if(2===t)return n(i);if(1===t){const t=e,i=[];if(i.push(`<${e.name}`),t.attributes&&Object.entries(t.attributes).forEach((([e,t])=>{i.push(` ${e}="${n(t)}"`)})),i.push(">"),!r.includes(e.name)){let t;t=s.includes(e.name)?e=>e.value:a,i.push(...e.children?.map(t)),i.push(`</${e.name}>`)}return i.join("")}};return a(e)})(e,t))).join("");const $=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"],h=["script","style","textarea","title"],y={amp:"&",gt:">",lt:"<",quot:'"'};var f=(e,t)=>g(e,{namedEntityMap:y,voidElements:$,textElements:h,...t}),E=(e,t={})=>m(e,{namedEntityMap:y,voidElements:$,textElements:h,...t});const x=1,w=2,v=3,b=4,C=e=>e.startsWith("(")&&e.endsWith(")"),W=e=>e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'"),S=/(\/\*(?:[\w\W]*?)\*\/)|(?:(["'])(?:\\.|(?!\2)[^\\\r\n])*\2)|(\((?:\\.|[^()"'])*?\))/g,j=/([\w-]+)\s*:([^:]*?)(;|$|\})/g,R=/@(-?[a-z][^{;@\s]*\s[^{;@]+?);/gi;var k=s=>{const[n,a,i,l]=e(s,4),p=new RegExp(`${n}(\\d+)${a}`,"g"),c=new RegExp(`${i}(\\d+)${l}`,"g"),o=new RegExp(`(?<=^|[;{}${n}${a}])\\s*([^;{}${n}${a}]+?)\\s*\\{([^{]*?)\\}`,"g"),u=[],d=[],g=(e,t,r,s)=>`${r}${e.push(t)-1}${s}`,m=e=>g(u,e,n,a),$=e=>g(d,e,i,l),h=e=>e.replace(c,((e,t)=>d[t])),y=(e,t=null)=>{const s=(e=(e=r(e)).replace(/ ?, ?/g,",")).indexOf(" ");let n=e,a="";return s>-1&&(n=e.slice(0,s),a=h(e.slice(s).trim()),"media"!==n&&"container"!==n||(a=a.replace(/ ?([<>=:\/]) ?/g,"$1"))),t?((e,t,r)=>({type:3,identifier:e,rule:t,declarations:r}))(n,a,t):((e,t)=>({type:4,identifier:e,rule:t}))(n,a)},f=e=>(e=(e=r(e)).replace(/ ?([,() ]) ?/g,"$1"),h(e)),E=(e,s)=>{const n=[];return s.split(p).forEach(((e,s)=>{s%2?n.push(u.at(+e)):e&&""!==e.replace(j,((e,s,a)=>(n.push(((e,s)=>{s=(s=r(s)).replace(/ ?, ?/g,","),e.startsWith("--")?" "!==s&&(s=s.trim()):""===(s=s.trim())&&t();const n=s.endsWith("!important");return n&&(s=s.slice(0,-10).trimEnd()),((e,t,r)=>({type:1,property:e,value:t,important:r}))(e,h(s),n)})(s,a)),""))).trim()&&t()})),e?e.startsWith("@")?y(e.slice(1),n):{type:2,selectors:r(e).split(/ ?, ?/).map((e=>(""===e&&t(),e=e.replace(/ ?([+>~]) ?/g,"$1"),h(e)))),declarations:n}:n};for(;S.test(s);)s=s.replace(S,(e=>C(e)?$(f(e)):W(e)?$(e):""));for((e=>e.includes('"')||e.includes("'"))(s)&&t(),s=s.replace(R,((e,t)=>m(y(t))));o.test(s);)s=s.replace(o,((e,t,r)=>m(E(t,r))));return E("",s)};const z=e=>{let t="";return e.forEach(((r,s)=>{t+=O(r),(1===r.type&&s!==e.length-1||4===r.type)&&(t+=";")})),t},O=e=>2===e.type?`${e.selectors}{${z(e.declarations)}}`:4===e.type?`@${e.identifier} ${e.rule}`:3===e.type?`${(e=>{let{rule:t,identifier:r}=e,s=`@${r}`;return t&&(s+=` ${t}`),s})(e)}{${z(e.declarations)}}`:1===e.type?`${e.property}:${e.value}${e.important?"!important":""}`:void 0;var M=(e,t={})=>z(e);export{l as NODE_TYPE_COMMENT,p as NODE_TYPE_DOCTYPE,a as NODE_TYPE_ELEMENT,i as NODE_TYPE_TEXT,v as RULE_TYPE_AT_RULE_BLOCK,b as RULE_TYPE_AT_RULE_STATEMENT,x as RULE_TYPE_DECLARATION,w as RULE_TYPE_RULESET,k as parseCss,f as parseHtml,g as parseSgml,M as stringifyCss,E as stringifyHtml,m as stringifySgml};
